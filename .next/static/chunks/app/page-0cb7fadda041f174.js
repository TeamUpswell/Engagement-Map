(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{50:function(e,o,n){Promise.resolve().then(n.bind(n,7991))},7991:function(e,o,n){"use strict";n.r(o),n.d(o,{default:function(){return MapContainer}});var r=n(7437),a=n(2265),t=n(4756);let l=(0,t.eI)("https://nrhkiebjzfrlixvniryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5yaGtpZWJqemZybGl4dm5pcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM2MjEzNjAsImV4cCI6MjA1OTE5NzM2MH0.JKs9nlJ05hkwJbhvnIVHtzn3PnQd-LKyNM5wahZrPpE");function FilterButton(e){let{active:o,onClick:n,count:a,label:t}=e;return(0,r.jsxs)("button",{onClick:n,style:{backgroundColor:o?"#007bff":"#f8f9fa",color:o?"#ffffff":"#333333",border:"1px solid ".concat(o?"#0069d9":"#ddd"),borderRadius:"4px",padding:"5px 10px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",transition:"all 0.2s ease"},children:[(0,r.jsx)("span",{children:t}),(0,r.jsx)("span",{style:{marginLeft:"6px",backgroundColor:o?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.1)",padding:"2px 6px",borderRadius:"20px",fontSize:"12px"},children:a})]})}var s=n(9738),i=n.n(s);function MapComponent(e){let{responses:o,style:n}=e,t=(0,a.useRef)(null),l=(0,a.useRef)(null),s=(0,a.useRef)([]),[c,d]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null);function addMarkersToMap(e){if(!l.current||!window.google||!window.google.maps){console.log("Can't add markers, map not ready");return}if(s.current.forEach(e=>{e.setMap(null)}),s.current=[],console.log("Adding ".concat(e.length," markers to map")),0===e.length){console.log("No responses to show on map");return}let o=new window.google.maps.LatLngBounds,n=0;e.forEach(e=>{if(!e.latitude||!e.longitude){console.log("Skipping response without coordinates");return}try{let r="https://maps.google.com/mapfiles/ms/icons/blue-dot.png";"yes"===e.ready_for_vaccine?r="https://maps.google.com/mapfiles/ms/icons/green-dot.png":"no"===e.ready_for_vaccine?r="https://maps.google.com/mapfiles/ms/icons/red-dot.png":"maybe"===e.ready_for_vaccine&&(r="https://maps.google.com/mapfiles/ms/icons/yellow-dot.png");let a=new window.google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:l.current,icon:r}),t=new window.google.maps.InfoWindow({content:'\n            <div style="padding: 10px;">\n              <h3 style="margin-top: 0; font-size: 16px;">Survey Response</h3>\n              <p><strong>Ready for vaccine:</strong> '.concat(e.ready_for_vaccine||"Unknown","</p>\n              <p><strong>Cares for girl:</strong> ").concat(e.cares_for_girl?"Yes":"No","</p>\n              <p><strong>Received HPV dose:</strong> ").concat(e.received_hpv_dose?"Yes":"No","</p>\n            </div>\n          ")});a.addListener("click",()=>{t.open(l.current,a)}),s.current.push(a),o.extend(a.getPosition()),n++}catch(e){console.error("Error creating marker:",e)}}),n>0?(l.current.fitBounds(o),google.maps.event.addListenerOnce(l.current,"bounds_changed",()=>{l.current.getZoom()>15&&l.current.setZoom(15)}),console.log("Added ".concat(n," markers and adjusted bounds"))):console.log("No valid markers to add")}return((0,a.useEffect)(()=>(console.log("Map component mounted, responses:",(null==o?void 0:o.length)||0),window.google&&window.google.maps?console.log("Google Maps API is available on mount"):console.log("Google Maps API is NOT available on mount"),()=>{console.log("Map component unmounting")}),[]),(0,a.useEffect)(()=>{if(!t.current){console.log("Map container ref not available");return}if(l.current){console.log("Map instance already exists");return}let checkGoogleMaps=()=>{if(!window.google||!window.google.maps){console.log("Waiting for Google Maps to load..."),setTimeout(checkGoogleMaps,500);return}try{console.log("Creating map instance now"),l.current=new window.google.maps.Map(t.current,{center:{lat:45.5101618,lng:-122.6961295},zoom:13,mapTypeId:window.google.maps.MapTypeId.ROADMAP}),l.current.addListener("tilesloaded",()=>{console.log("Map tiles loaded"),d(!0)}),console.log("Map instance created"),o&&o.length>0&&addMarkersToMap(o)}catch(e){console.error("Error initializing map:",e),p("Failed to initialize map: ".concat(e.message))}};return checkGoogleMaps(),()=>{l.current&&console.log("Cleaning up map instance")}},[t]),(0,a.useEffect)(()=>{if(!c){console.log("Map not loaded yet, waiting to add markers");return}console.log("Responses or map changed, updating markers"),addMarkersToMap(o)},[o,c]),g)?(0,r.jsxs)("div",{style:{...n,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f9fa",padding:"20px"},children:[(0,r.jsx)("h3",{style:{color:"#dc3545"},children:"Map Error"}),(0,r.jsx)("p",{children:g}),(0,r.jsx)("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"10px"},children:"Reload Page"})]}):(0,r.jsxs)("div",{style:{position:"relative",...n},children:[(0,r.jsx)("div",{ref:t,style:{width:"100%",height:"100%",border:"1px solid #ddd"}}),!c&&(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255,255,255,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},children:(0,r.jsxs)("div",{style:{textAlign:"center"},className:"jsx-c8519d994a443018",children:[(0,r.jsx)("div",{style:{width:"40px",height:"40px",margin:"0 auto 10px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-c8519d994a443018"}),(0,r.jsx)("p",{className:"jsx-c8519d994a443018",children:"Loading map..."}),(0,r.jsx)(i(),{id:"c8519d994a443018",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})})]})}function GoogleMapsLoader(){let[e,o]=(0,a.useState)(!1),[n,t]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(window.google&&window.google.maps){console.log("Google Maps already loaded"),o(!0);return}if(window.__GOOGLE_MAPS_LOADING__){console.log("Google Maps loading already in progress");return}window.__GOOGLE_MAPS_LOADING__=!0,console.log("Loading Google Maps API...");let e="AIzaSyA9qs4iPMj6Rp6Uf-zQGqKEWCasZU-K5PI";if(!e){console.error("Google Maps API key is missing!"),t("Google Maps API key is missing!");return}let n=document.createElement("script");return n.id="google-maps-script",n.src="https://maps.googleapis.com/maps/api/js?key=".concat(e,"&libraries=places"),n.async=!0,n.defer=!0,n.onload=()=>{console.log("Google Maps API loaded successfully"),o(!0),window.__GOOGLE_MAPS_LOADING__=!1},n.onerror=e=>{console.error("Error loading Google Maps API:",e),t("Failed to load Google Maps"),window.__GOOGLE_MAPS_LOADING__=!1},document.head.appendChild(n),()=>{window.__GOOGLE_MAPS_LOADING__=!1}},[]),n)?(0,r.jsx)("div",{style:{position:"fixed",top:"5px",right:"5px",padding:"8px 12px",backgroundColor:"#f44336",color:"white",borderRadius:"4px",fontSize:"14px",zIndex:9999},children:n}):null}function MapContainer(){let[e,o]=(0,a.useState)(!0),[n,t]=(0,a.useState)([]),[s,i]=(0,a.useState)({all:!0,yesVaccine:!1,noVaccine:!1,maybeVaccine:!1,caresForGirl:!1,receivedDose:!1}),[c,d]=(0,a.useState)({total:0,yesVaccine:0,noVaccine:0,maybeVaccine:0,caresForGirl:0,receivedDose:0});(0,a.useEffect)(()=>{!async function(){try{console.log("Fetching data from Supabase...");let{data:e,error:o}=await l.from("survey_responses").select("*");if(o){console.error("Supabase error:",o);return}console.log("Data received:",(null==e?void 0:e.length)||0,"records");let n={total:(null==e?void 0:e.length)||0,yesVaccine:(null==e?void 0:e.filter(e=>"yes"===e.ready_for_vaccine).length)||0,noVaccine:(null==e?void 0:e.filter(e=>"no"===e.ready_for_vaccine).length)||0,maybeVaccine:(null==e?void 0:e.filter(e=>"maybe"===e.ready_for_vaccine).length)||0,caresForGirl:(null==e?void 0:e.filter(e=>e.cares_for_girl).length)||0,receivedDose:(null==e?void 0:e.filter(e=>e.received_hpv_dose).length)||0};d(n),t(e||[])}catch(e){console.error("Error fetching data:",e)}finally{o(!1),console.log("Loading state set to false")}}()},[]);let handleFilterChange=e=>{if("all"===e)i({all:!0,yesVaccine:!1,noVaccine:!1,maybeVaccine:!1,caresForGirl:!1,receivedDose:!1});else{i({...s,all:!1,[e]:!s[e]});let o={...s,all:!1,[e]:!s[e]},n=Object.keys(o).some(e=>"all"!==e&&o[e]);n||(o.all=!0),i(o)}},g=n.filter(e=>{if(s.all)return!0;let o=!1;return s.yesVaccine&&"yes"===e.ready_for_vaccine&&(o=!0),s.noVaccine&&"no"===e.ready_for_vaccine&&(o=!0),s.maybeVaccine&&"maybe"===e.ready_for_vaccine&&(o=!0),s.caresForGirl&&e.cares_for_girl&&(o=!0),s.receivedDose&&e.received_hpv_dose&&(o=!0),o});return(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[(0,r.jsx)(GoogleMapsLoader,{}),(0,r.jsxs)("header",{style:{backgroundColor:"#f8f9fa",padding:"10px 20px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,r.jsx)("h1",{style:{margin:0,fontSize:"20px",marginBottom:"10px"},children:"Engagement Map"}),!e&&(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[(0,r.jsx)(FilterButton,{active:s.all,onClick:()=>handleFilterChange("all"),count:c.total,label:"All Responses"}),(0,r.jsx)(FilterButton,{active:s.yesVaccine,onClick:()=>handleFilterChange("yesVaccine"),count:c.yesVaccine,label:"Ready for Vaccine"}),(0,r.jsx)(FilterButton,{active:s.noVaccine,onClick:()=>handleFilterChange("noVaccine"),count:c.noVaccine,label:"Not Ready for Vaccine"}),(0,r.jsx)(FilterButton,{active:s.maybeVaccine,onClick:()=>handleFilterChange("maybeVaccine"),count:c.maybeVaccine,label:"Maybe Ready"}),(0,r.jsx)(FilterButton,{active:s.caresForGirl,onClick:()=>handleFilterChange("caresForGirl"),count:c.caresForGirl,label:"Cares for Girl"}),(0,r.jsx)(FilterButton,{active:s.receivedDose,onClick:()=>handleFilterChange("receivedDose"),count:c.receivedDose,label:"Received HPV Dose"})]}),(0,r.jsxs)("div",{style:{fontSize:"14px"},children:["Currently showing ",g.length," of ",c.total," ","total responses"]})]})]}),(0,r.jsx)("main",{style:{flex:1,width:"100%"},children:e?(0,r.jsx)("div",{style:{height:"calc(100vh - 120px)",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,r.jsx)("p",{children:"Loading map data..."})}):(0,r.jsx)(MapComponent,{responses:g,style:{width:"100%",height:"calc(100vh - 120px)"}})})]})}}},function(e){e.O(0,[341,756,971,472,744],function(){return e(e.s=50)}),_N_E=e.O()}]);