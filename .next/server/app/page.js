(()=>{var e={};e.id=931,e.ids=[931],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8359:()=>{},3739:()=>{},7355:(e,o,r)=>{"use strict";r.r(o),r.d(o,{GlobalError:()=>s.a,__next_app__:()=>g,originalPathname:()=>p,pages:()=>d,routeModule:()=>u,tree:()=>c});var t=r(7096),n=r(6132),a=r(7284),s=r.n(a),i=r(2564),l={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>i[e]);r.d(o,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2707)),"/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,5345)),"/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/layout.tsx"],error:[()=>Promise.resolve().then(r.bind(r,8196)),"/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/error.tsx"],loading:[()=>Promise.resolve().then(r.bind(r,8734)),"/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/loading.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,9291,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/page.tsx"],p="/page",g={require:r,loadChunk:()=>Promise.resolve()},u=new t.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},6239:(e,o,r)=>{Promise.resolve().then(r.bind(r,1158))},1158:(e,o,r)=>{"use strict";r.r(o),r.d(o,{default:()=>MapContainer});var t=r(784),n=r(9885),a=r(6315);let s=(0,a.createClient)("https://nrhkiebjzfrlixvniryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5yaGtpZWJqemZybGl4dm5pcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM2MjEzNjAsImV4cCI6MjA1OTE5NzM2MH0.JKs9nlJ05hkwJbhvnIVHtzn3PnQd-LKyNM5wahZrPpE");function FilterButton({active:e,onClick:o,count:r,label:n}){return(0,t.jsxs)("button",{onClick:o,style:{backgroundColor:e?"#007bff":"#f8f9fa",color:e?"#ffffff":"#333333",border:`1px solid ${e?"#0069d9":"#ddd"}`,borderRadius:"4px",padding:"5px 10px",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",transition:"all 0.2s ease"},children:[t.jsx("span",{children:n}),t.jsx("span",{style:{marginLeft:"6px",backgroundColor:e?"rgba(255,255,255,0.2)":"rgba(0,0,0,0.1)",padding:"2px 6px",borderRadius:"20px",fontSize:"12px"},children:r})]})}var i=r(3745),l=r.n(i);function MapComponent({responses:e,style:o}){let r=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)([]),[i,c]=(0,n.useState)(!1),[d,p]=(0,n.useState)(null);function addMarkersToMap(e){if(!a.current||!window.google||!window.google.maps){console.log("Can't add markers, map not ready");return}if(s.current.forEach(e=>{e.setMap(null)}),s.current=[],console.log(`Adding ${e.length} markers to map`),0===e.length){console.log("No responses to show on map");return}let o=new window.google.maps.LatLngBounds,r=0;e.forEach(e=>{if(!e.latitude||!e.longitude){console.log("Skipping response without coordinates");return}try{let t="https://maps.google.com/mapfiles/ms/icons/blue-dot.png";"yes"===e.ready_for_vaccine?t="https://maps.google.com/mapfiles/ms/icons/green-dot.png":"no"===e.ready_for_vaccine?t="https://maps.google.com/mapfiles/ms/icons/red-dot.png":"maybe"===e.ready_for_vaccine&&(t="https://maps.google.com/mapfiles/ms/icons/yellow-dot.png");let n=new window.google.maps.Marker({position:{lat:e.latitude,lng:e.longitude},map:a.current,icon:t}),i=new window.google.maps.InfoWindow({content:`
            <div style="padding: 10px;">
              <h3 style="margin-top: 0; font-size: 16px;">Survey Response</h3>
              <p><strong>Ready for vaccine:</strong> ${e.ready_for_vaccine||"Unknown"}</p>
              <p><strong>Cares for girl:</strong> ${e.cares_for_girl?"Yes":"No"}</p>
              <p><strong>Received HPV dose:</strong> ${e.received_hpv_dose?"Yes":"No"}</p>
            </div>
          `});n.addListener("click",()=>{i.open(a.current,n)}),s.current.push(n),o.extend(n.getPosition()),r++}catch(e){console.error("Error creating marker:",e)}}),r>0?(a.current.fitBounds(o),google.maps.event.addListenerOnce(a.current,"bounds_changed",()=>{a.current.getZoom()>15&&a.current.setZoom(15)}),console.log(`Added ${r} markers and adjusted bounds`)):console.log("No valid markers to add")}return((0,n.useEffect)(()=>(console.log("Map component mounted, responses:",e?.length||0),window.google&&window.google.maps?console.log("Google Maps API is available on mount"):console.log("Google Maps API is NOT available on mount"),()=>{console.log("Map component unmounting")}),[]),(0,n.useEffect)(()=>{if(!r.current){console.log("Map container ref not available");return}if(a.current){console.log("Map instance already exists");return}let checkGoogleMaps=()=>{if(!window.google||!window.google.maps){console.log("Waiting for Google Maps to load..."),setTimeout(checkGoogleMaps,500);return}try{console.log("Creating map instance now"),a.current=new window.google.maps.Map(r.current,{center:{lat:45.5101618,lng:-122.6961295},zoom:13,mapTypeId:window.google.maps.MapTypeId.ROADMAP}),a.current.addListener("tilesloaded",()=>{console.log("Map tiles loaded"),c(!0)}),console.log("Map instance created"),e&&e.length>0&&addMarkersToMap(e)}catch(e){console.error("Error initializing map:",e),p(`Failed to initialize map: ${e.message}`)}};return checkGoogleMaps(),()=>{a.current&&console.log("Cleaning up map instance")}},[r]),(0,n.useEffect)(()=>{if(!i){console.log("Map not loaded yet, waiting to add markers");return}console.log("Responses or map changed, updating markers"),addMarkersToMap(e)},[e,i]),d)?(0,t.jsxs)("div",{style:{...o,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f8f9fa",padding:"20px"},children:[t.jsx("h3",{style:{color:"#dc3545"},children:"Map Error"}),t.jsx("p",{children:d}),t.jsx("button",{onClick:()=>window.location.reload(),style:{padding:"8px 16px",backgroundColor:"#007bff",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",marginTop:"10px"},children:"Reload Page"})]}):(0,t.jsxs)("div",{style:{position:"relative",...o},children:[t.jsx("div",{ref:r,style:{width:"100%",height:"100%",border:"1px solid #ddd"}}),!i&&t.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255,255,255,0.8)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1},children:(0,t.jsxs)("div",{style:{textAlign:"center"},className:"jsx-c8519d994a443018",children:[t.jsx("div",{style:{width:"40px",height:"40px",margin:"0 auto 10px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite"},className:"jsx-c8519d994a443018"}),t.jsx("p",{className:"jsx-c8519d994a443018",children:"Loading map..."}),t.jsx(l(),{id:"c8519d994a443018",children:"@-webkit-keyframes spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes spin{0%{-moz-transform:rotate(0deg);transform:rotate(0deg)}100%{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes spin{0%{-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes spin{0%{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}100%{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"})]})})]})}function GoogleMapsLoader(){let[e,o]=(0,n.useState)(!1),[r,a]=(0,n.useState)(null);return((0,n.useEffect)(()=>{if(window.google&&window.google.maps){console.log("Google Maps already loaded"),o(!0);return}if(window.__GOOGLE_MAPS_LOADING__){console.log("Google Maps loading already in progress");return}window.__GOOGLE_MAPS_LOADING__=!0,console.log("Loading Google Maps API...");let e="AIzaSyA9qs4iPMj6Rp6Uf-zQGqKEWCasZU-K5PI";if(!e){console.error("Google Maps API key is missing!"),a("Google Maps API key is missing!");return}let r=document.createElement("script");return r.id="google-maps-script",r.src=`https://maps.googleapis.com/maps/api/js?key=${e}&libraries=places`,r.async=!0,r.defer=!0,r.onload=()=>{console.log("Google Maps API loaded successfully"),o(!0),window.__GOOGLE_MAPS_LOADING__=!1},r.onerror=e=>{console.error("Error loading Google Maps API:",e),a("Failed to load Google Maps"),window.__GOOGLE_MAPS_LOADING__=!1},document.head.appendChild(r),()=>{window.__GOOGLE_MAPS_LOADING__=!1}},[]),r)?t.jsx("div",{style:{position:"fixed",top:"5px",right:"5px",padding:"8px 12px",backgroundColor:"#f44336",color:"white",borderRadius:"4px",fontSize:"14px",zIndex:9999},children:r}):null}function MapContainer(){let[e,o]=(0,n.useState)(!0),[r,a]=(0,n.useState)([]),[i,l]=(0,n.useState)({all:!0,yesVaccine:!1,noVaccine:!1,maybeVaccine:!1,caresForGirl:!1,receivedDose:!1}),[c,d]=(0,n.useState)({total:0,yesVaccine:0,noVaccine:0,maybeVaccine:0,caresForGirl:0,receivedDose:0});(0,n.useEffect)(()=>{(async function(){try{console.log("Fetching data from Supabase...");let{data:e,error:o}=await s.from("survey_responses").select("*");if(o){console.error("Supabase error:",o);return}console.log("Data received:",e?.length||0,"records");let r={total:e?.length||0,yesVaccine:e?.filter(e=>"yes"===e.ready_for_vaccine).length||0,noVaccine:e?.filter(e=>"no"===e.ready_for_vaccine).length||0,maybeVaccine:e?.filter(e=>"maybe"===e.ready_for_vaccine).length||0,caresForGirl:e?.filter(e=>e.cares_for_girl).length||0,receivedDose:e?.filter(e=>e.received_hpv_dose).length||0};d(r),a(e||[])}catch(e){console.error("Error fetching data:",e)}finally{o(!1),console.log("Loading state set to false")}})()},[]);let handleFilterChange=e=>{if("all"===e)l({all:!0,yesVaccine:!1,noVaccine:!1,maybeVaccine:!1,caresForGirl:!1,receivedDose:!1});else{l({...i,all:!1,[e]:!i[e]});let o={...i,all:!1,[e]:!i[e]},r=Object.keys(o).some(e=>"all"!==e&&o[e]);r||(o.all=!0),l(o)}},p=r.filter(e=>{if(i.all)return!0;let o=!1;return i.yesVaccine&&"yes"===e.ready_for_vaccine&&(o=!0),i.noVaccine&&"no"===e.ready_for_vaccine&&(o=!0),i.maybeVaccine&&"maybe"===e.ready_for_vaccine&&(o=!0),i.caresForGirl&&e.cares_for_girl&&(o=!0),i.receivedDose&&e.received_hpv_dose&&(o=!0),o});return(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",minHeight:"100vh"},children:[t.jsx(GoogleMapsLoader,{}),(0,t.jsxs)("header",{style:{backgroundColor:"#f8f9fa",padding:"10px 20px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[t.jsx("h1",{style:{margin:0,fontSize:"20px",marginBottom:"10px"},children:"Engagement Map"}),!e&&(0,t.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[(0,t.jsxs)("div",{style:{display:"flex",gap:"8px",flexWrap:"wrap"},children:[t.jsx(FilterButton,{active:i.all,onClick:()=>handleFilterChange("all"),count:c.total,label:"All Responses"}),t.jsx(FilterButton,{active:i.yesVaccine,onClick:()=>handleFilterChange("yesVaccine"),count:c.yesVaccine,label:"Ready for Vaccine"}),t.jsx(FilterButton,{active:i.noVaccine,onClick:()=>handleFilterChange("noVaccine"),count:c.noVaccine,label:"Not Ready for Vaccine"}),t.jsx(FilterButton,{active:i.maybeVaccine,onClick:()=>handleFilterChange("maybeVaccine"),count:c.maybeVaccine,label:"Maybe Ready"}),t.jsx(FilterButton,{active:i.caresForGirl,onClick:()=>handleFilterChange("caresForGirl"),count:c.caresForGirl,label:"Cares for Girl"}),t.jsx(FilterButton,{active:i.receivedDose,onClick:()=>handleFilterChange("receivedDose"),count:c.receivedDose,label:"Received HPV Dose"})]}),(0,t.jsxs)("div",{style:{fontSize:"14px"},children:["Currently showing ",p.length," of ",c.total," ","total responses"]})]})]}),t.jsx("main",{style:{flex:1,width:"100%"},children:e?t.jsx("div",{style:{height:"calc(100vh - 120px)",display:"flex",justifyContent:"center",alignItems:"center"},children:t.jsx("p",{children:"Loading map data..."})}):t.jsx(MapComponent,{responses:p,style:{width:"100%",height:"calc(100vh - 120px)"}})})]})}},2707:(e,o,r)=>{"use strict";r.r(o),r.d(o,{default:()=>Home});var t=r(4656),n=r(5153);let a=(0,n.createProxy)(String.raw`/Users/drewbernard/Documents/Visual Studio/Engagement Map/next-maps-app/app/components/MapContainer.tsx`),{__esModule:s,$$typeof:i}=a,l=a.default;function Home(){return t.jsx(l,{})}}};var o=require("../webpack-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[399,315,874],()=>__webpack_exec__(7355));module.exports=r})();